<div class="container py-4 adiciona-bloco">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
      <div class="card shadow">
        <div class="card-header bg-success text-white d-flex align-items-center">
          <h2 class="mb-0"><i class="fas fa-building me-2"></i>{{#if bloco}}Editar Bloco{{else}}Cadastrar Bloco{{/if}}</h2>
        </div>
        <div class="card-body">
          <form id="blocoForm" action="{{#if bloco}}/editarBloco/{{bloco.id_bloco}}{{else}}/bloco{{/if}}" method="POST">
            <div class="mb-3">
              <label for="descricao" class="form-label">Nome do bloco</label>
              <input
                type="text"
                id="descricao"
                name="descricao"
                class="form-control"
                required
                placeholder="Ex: Bloco A, Bloco B, Bloco C"
                value="{{#if bloco}}{{bloco.descricao}}{{/if}}"
              />
            </div>
            <button type="submit" class="btn btn-success w-100">
              <i class="fas fa-save me-2"></i>{{#if bloco}}Salvar Alterações{{else}}Cadastrar{{/if}}
            </button>
          </form>
          {{#if erro}}
            <div class="alert alert-danger mt-3" role="alert">
              {{erro}}
            </div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
</div>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
<link rel="stylesheet" href="/stylesheets/bloco.css" />
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('blocoForm');
  if (!form) return;
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    const nomeBloco = document.getElementById('descricao').value.trim();
    try {
      const resp = await fetch(`/api/blocos/check?nome=${encodeURIComponent(nomeBloco)}`);
      const result = await resp.json();
      if (result && result.duplicado) {
        const msg = `${nomeBloco} já foi cadastrado, tem certeza que quer prosseguir?`;
        if (!window.confirm(msg)) return;
      }
    } catch (err) {
      // Se erro, deixa enviar
    }
    form.submit();
  });
});
</script>