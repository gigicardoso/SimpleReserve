<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Salas</title>
  <link rel="stylesheet" href="/stylesheets/pesquisarSalas.css">
</head>
<body>
  <div class="container" style="padding-left: 40px;">
    <div class="header" style="margin-top: 40px; margin-bottom: 40px;">
      <div class="title-container">
        <h1 style="color: #6a774a; font-size: 28px; font-weight: 600; margin: 0; font-family: 'Poppins', sans-serif; white-space: nowrap;"><i class="fas fa-search"></i> Consulta de Salas</h1>
      </div>
    </div>
  <div class="search-container" style="margin-bottom: 40px; margin-left: -30px;">
      <div class="search-wrapper">
        <span class="search-icon"><i class="fas fa-search"></i></span>
        <input type="text" class="search-input" placeholder="Pesquisar por nome da sala..." id="search-input">
      </div>
      <select class="filter-select" id="floor-filter">
        <option value="">Todos os andares</option>
        {{#each andares}}
          <option value="{{this}}">{{this}}º</option>
        {{/each}}
      </select>
      <select class="filter-select" id="block-filter">
        <option value="">Todos os blocos</option>
        {{#each blocos}}
          <option value="{{this}}">{{this}}</option>
        {{/each}}
      </select>
    </div>
    <div class="rooms-grid" id="rooms-container">
      <!-- Cards de salas serão renderizados pelo JS -->
    </div>
    <div id="error-message" style="display:none; color:#e74c3c; text-align:center; margin-top:30px; font-size:1.2rem;">Erro ao carregar salas. Tente novamente mais tarde.</div>
  </div>

  <!-- Modal para detalhes da sala -->
      <div class="modal" id="room-modal">
      <div class="modal-content" style="border-radius: 16px; box-shadow: 0 10px 30px rgba(132,146,91,0.18); background: #fff; max-width: 800px; width: 100%;">
        <div class="modal-header" style="background: linear-gradient(90deg, #84925b 0%, #6a774a 100%); border-radius: 16px 16px 0 0; display: flex; align-items: center; justify-content: space-between; padding: 18px 32px 18px 32px; position: relative;">
          <h2 class="modal-title" id="modal-room-name" style="font-weight: 700; color: #fff; font-size: 26px; margin: 0; text-align: left; letter-spacing: 1px;">Nome da Sala</h2>
          <button class="close-btn" id="close-modal" style="background: none; border: none; font-size: 22px; cursor: pointer; color: #fff; margin-left: 16px;">&times;</button>
        </div>
        <div class="modal-body" style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; padding: 32px; align-items: flex-start;">
          <div>
            <img src="" alt="Sala" class="modal-image" id="modal-room-image" style="margin-bottom: 18px; border-radius: 12px; box-shadow: 0 4px 16px rgba(132,146,91,0.12); width: 100%; max-width: 340px; max-height: 220px; object-fit: cover;">
            <div style="margin-top: 24px; padding-top: 12px; border-top: 1px solid #e0e4d7;">
              <h3 style="text-align: left; color: #6a774a; font-weight: 600; margin-bottom: 8px;">Descrição:</h3>
              <p class="description" id="modal-description" style="text-align: left; color: #555; margin: 0;">-</p>
            </div>
          </div>
          <div class="modal-details" style="width: 100%; max-width: 370px; background: #f5f7fa; border-radius: 12px; box-shadow: 0 2px 8px rgba(132,146,91,0.08); padding: 20px 18px;">
            <div class="detail-row" style="justify-content: space-between; margin-bottom: 12px;">
              <span class="detail-label" style="text-align: left; font-weight: 500;">Nome da Sala:</span>
              <span class="detail-value" id="modal-room-name-info" style="text-align: right;">-</span>
            </div>
            <div class="detail-row" style="justify-content: space-between; margin-bottom: 12px;">
              <span class="detail-label" style="text-align: left; font-weight: 500;">Tipo de Sala:</span>
              <span class="detail-value" id="modal-type" style="text-align: right;">-</span>
            </div>
            <div class="detail-row" style="justify-content: space-between; margin-bottom: 12px;">
              <span class="detail-label" style="text-align: left; font-weight: 500;">Bloco:</span>
              <span class="detail-value" id="modal-block" style="text-align: right;">-</span>
            </div>
            <div class="detail-row" style="justify-content: space-between; margin-bottom: 12px;">
              <span class="detail-label" style="text-align: left; font-weight: 500;">Andar:</span>
              <span class="detail-value" id="modal-floor" style="text-align: right;">-</span>
            </div>
            <div class="detail-row" style="justify-content: space-between; margin-bottom: 12px;">
              <span class="detail-label" style="text-align: left; font-weight: 500;">Capacidade:</span>
              <span class="detail-value" id="modal-capacity" style="text-align: right;">-</span>
            </div>
            <div class="detail-row" style="justify-content: space-between; margin-bottom: 12px;">
              <span class="detail-label" style="text-align: left; font-weight: 500;">Tipo de Mesa:</span>
              <span class="detail-value" id="modal-table" style="text-align: right;">-</span>
            </div>
            <div style="margin-top: 24px; padding-top: 12px; border-top: 1px solid #e0e4d7;">
              <div class="detail-row" style="justify-content: space-between; margin-bottom: 8px;">
                <span class="detail-label">Ar-condicionado:</span>
                <span class="detail-value" id="modal-ar-cond">-</span>
              </div>
              <div class="detail-row" style="justify-content: space-between; margin-bottom: 8px;">
                <span class="detail-label">Projetor:</span>
                <span class="detail-value" id="modal-projetor">-</span>
              </div>
              <div class="detail-row" style="justify-content: space-between; margin-bottom: 8px;">
                <span class="detail-label">Quadro Branco:</span>
                <span class="detail-value" id="modal-quadro">-</span>
              </div>
              <div class="detail-row" style="justify-content: space-between; margin-bottom: 8px;">
                <span class="detail-label">Computadores:</span>
                <span class="detail-value" id="modal-computador">-</span>
              </div>
              <div class="detail-row" style="justify-content: space-between; margin-bottom: 8px;">
                <span class="detail-label">Mesas de canhoto:</span>
                <span class="detail-value" id="modal-mesa-canhoto">-</span>
              </div>
              <div class="detail-row" style="justify-content: space-between; margin-bottom: 8px;">
                <span class="detail-label">A sala é acessível?:</span>
                <span class="detail-value" id="modal-acess">-</span>
              </div>
              <div class="detail-row" style="justify-content: space-between; margin-bottom: 8px;">
                <span class="detail-label">Mesas acessíveis:</span>
                <span class="detail-value" id="modal-mesa-acess">-</span>
              </div>
            </div>
          </div>
        </div>
      </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
  <script>
    async function carregarSalas() {
      try {
        const response = await fetch('/api/salas');
        const salas = await response.json();
        window.salasData = salas;
        renderRooms(salas);
        document.getElementById('error-message').style.display = 'none';
      } catch (error) {
        console.error('Erro ao carregar salas:', error);
        document.getElementById('rooms-container').innerHTML = '';
        document.getElementById('error-message').style.display = 'block';
      }
    }

    const roomsContainer = document.getElementById('rooms-container');
    const searchInput = document.getElementById('search-input');
    const floorFilter = document.getElementById('floor-filter');
    const blockFilter = document.getElementById('block-filter');
    const roomModal = document.getElementById('room-modal');
    const closeModal = document.getElementById('close-modal');

    function renderRooms(rooms) {
      roomsContainer.innerHTML = '';
      if (!rooms.length) {
        roomsContainer.innerHTML = '<p style="text-align:center; color:#7f8c8d; font-size:1.1rem;">Nenhuma sala encontrada.</p>';
        return;
      }
      rooms.forEach(room => {
        const roomCard = document.createElement('div');
        roomCard.className = 'room-card';
        roomCard.innerHTML = `
          <img src="${room.imagem_url || '/images/logo.png'}" alt="${room.nome}" class="room-image">
          <div class="room-info">
            <h3 class="room-name">${room.nome}</h3>
            <div class="room-details">
              <span>${room.andar}º</span>
              <span>${room.bloco}</span>
            </div>
            <div class="room-features">
              <span class="feature-tag">${room.capacidade} lugares</span>
              <span class="feature-tag">${room.tipo_sala}</span>
            </div>
          </div>
        `;
        roomCard.addEventListener('click', () => openRoomModal(room));
        roomsContainer.appendChild(roomCard);
      });
    }

    function openRoomModal(room) {
  document.getElementById('modal-room-name').textContent = room.nome;
  document.getElementById('modal-room-image').src = room.imagem_url || '/images/logo.png';
  document.getElementById('modal-type').textContent = room.tipo_sala;
  document.getElementById('modal-floor').textContent = `${room.andar}º`;
  document.getElementById('modal-block').textContent = `${room.bloco}`;
  document.getElementById('modal-capacity').textContent = `${room.capacidade} pessoas`;
  document.getElementById('modal-table').textContent = room.tipo_mesa;
  document.getElementById('modal-description').textContent = room.descricao;
  document.getElementById('modal-room-name-info').textContent = room.nome;
  document.getElementById('modal-ar-cond').textContent = room.ar_cond === true ? 'Sim' : (room.ar_cond === false ? 'Não' : '-');
  document.getElementById('modal-projetor').textContent = room.projetor === true ? 'Sim' : (room.projetor === false ? 'Não' : '-');
  document.getElementById('modal-quadro').textContent = room.quadro === true ? 'Sim' : (room.quadro === false ? 'Não' : '-');
  document.getElementById('modal-computador').textContent = (room.computador !== undefined && room.computador !== null) ? room.computador : '-';
  document.getElementById('modal-mesa-canhoto').textContent = (room.mesa_canhoto !== undefined && room.mesa_canhoto !== null) ? room.mesa_canhoto : '-';
  document.getElementById('modal-acess').textContent = room.acess === true ? 'Sim' : (room.acess === false ? 'Não' : '-');
  document.getElementById('modal-mesa-acess').textContent = (room.mesa_acess !== undefined && room.mesa_acess !== null) ? room.mesa_acess : '-';
      roomModal.style.display = 'flex';
    }

    function filterRooms() {
      const searchTerm = searchInput.value.toLowerCase();
      const selectedFloor = floorFilter.value;
      const selectedBlock = blockFilter.value;
      const rooms = window.salasData || [];
      const filteredRooms = rooms.filter(room => {
        const matchesSearch = room.nome.toLowerCase().includes(searchTerm);
        const matchesFloor = !selectedFloor || room.andar.toString() === selectedFloor;
        const matchesBlock = !selectedBlock || room.bloco === selectedBlock;
        return matchesSearch && matchesFloor && matchesBlock;
      });
      renderRooms(filteredRooms);
    }

    searchInput.addEventListener('input', filterRooms);
    floorFilter.addEventListener('change', filterRooms);
    blockFilter.addEventListener('change', filterRooms);
    closeModal.addEventListener('click', () => {
      roomModal.style.display = 'none';
    });
    window.addEventListener('click', (event) => {
      if (event.target === roomModal) {
        roomModal.style.display = 'none';
      }
    });

    carregarSalas();
  </script>
</body>
</html>

