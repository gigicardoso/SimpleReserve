<div class="container">
	<div class="header">
		<div class="title-container">
			<h1><i class="bi bi-clock-history"></i> Relatório Pessoal</h1>
			<!-- PDF export button -->
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
			<button id="btnExportPdfPersonal" onclick="exportarHistoricoPDFPersonal()" style="font-size:14px; margin-left:12px; padding:8px 14px; border-radius:8px; display:inline-flex; align-items:center; gap:8px; background:#84925b; color:#fff; border:none; font-weight:600; white-space:nowrap;">
				<i class="bi bi-file-earmark-pdf"></i> Emitir Relatório em PDF
			</button>
		</div>
	</div>
	<div class="user-table-container">
		<table class="user-table">
			<thead>
				<tr>
					<th>Usuário</th>
					<th>Sala</th>
					<th>Data</th>
					<th>Horário</th>
				</tr>
			</thead>
			<tbody>
	{{#each reservas}}
		<tr>
			<td>{{this.nomeUsuario}}</td>
			<td>{{this.nomeSala}}</td>
			<td>{{formatarData this.dataReserva}}</td>
			<td>{{this.horaInicio}} - {{this.horaFim}}</td>
		</tr>
	{{else}}
		<tr><td colspan="4" style="color: gray;">Nenhuma reserva encontrada.</td></tr>
	{{/each}}
			</tbody>
		</table>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<link rel="stylesheet" href="/stylesheets/usuariosAdm.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
function exportarHistoricoPDFPersonal() {
	if (typeof jspdf === 'undefined' || typeof window.jspdf === 'undefined') {
		alert('Erro: jsPDF não carregado');
		return;
	}
	const { jsPDF } = window.jspdf;
	const doc = new jsPDF();
	doc.setFontSize(16);
	doc.text('Relatório Pessoal', 105, 15, { align: 'center' });

	const rows = Array.from(document.querySelectorAll('.user-table tbody tr'))
		.filter(r => r.style.display !== 'none')
		.map(r => {
			const cols = r.querySelectorAll('td');
			return [
				cols[0] ? cols[0].innerText.trim() : '',
				cols[1] ? cols[1].innerText.trim() : '',
				cols[2] ? cols[2].innerText.trim() : '',
				cols[3] ? cols[3].innerText.trim() : ''
			];
		});

	const head = [['Usuário', 'Sala', 'Data', 'Horário']];

	doc.autoTable({
		head: head,
		body: rows,
		startY: 25,
		styles: { fontSize: 10, cellPadding: 3 },
		headStyles: { fillColor: [76, 175, 80], textColor: 255, fontStyle: 'bold' }
	});

	doc.save('relatorio_pessoal.pdf');
}
</script>
