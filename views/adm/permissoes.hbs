<div class="container">
	<div class="header" style="margin-bottom: 10px;">
		<div class="title-container" style="display: flex; align-items: center; gap: 20px;">
			<h1 style="margin-bottom: 10px;"><i class="bi bi-award"></i> Gerenciador de Permissões</h1>
			<a href="/permissoes/adicionapermissao" class="btn-add" id="btnAddPermissao" title="Adicionar permissão" style="text-decoration: none; display: flex; align-items: center; justify-content: center;">
				<i class="bi bi-plus" style="font-size: 2rem; vertical-align: middle;"></i>
			</a>
			<!-- Info button: opens modal with permission explanation -->
			<button id="btnPermInfo" class="btn-add" title="Informações sobre permissões" style="margin-left:8px; display:flex; align-items:center; justify-content:center;">
			  <i class="bi bi-patch-question" style="font-size:1.6rem; vertical-align: middle;"></i>
			</button>
		</div>
		<!-- explanatory alert removed; content moved to modal triggered by the info button -->
	</div>
	<div class="user-table-container" style="margin-top: 18px;">
		<table class="user-table">
			<thead>
				<tr>
					<th>Nome</th>
					<th>Administrador</th>
					<th>Cadastrar Sala</th>
					<th>Editar Salas</th>
					<th>Arquivar Sala</th>
					<th>Cadastrar Usuário</th>
					<th>Editar Usuário</th>
					<th>Arquivar Usuário</th>
					<th>Ações</th>
				</tr>
			</thead>
			<tbody>
				{{#if permissoes.length}}
					{{#each permissoes}}
						<tr>
							<td>{{this.descricao}}</td>
							<td>{{#if this.adm}}Sim{{else}}Não{{/if}}</td>
							<td>{{#if this.cadSala}}Sim{{else}}Não{{/if}}</td>
							<td>{{#if this.edSalas}}Sim{{else}}Não{{/if}}</td>
							<td>{{#if this.arqSala}}Sim{{else}}Não{{/if}}</td>
							<td>{{#if this.cadUser}}Sim{{else}}Não{{/if}}</td>
							<td>{{#if this.edUser}}Sim{{else}}Não{{/if}}</td>
							<td>{{#if this.arqUser}}Sim{{else}}Não{{/if}}</td>
							<td class="actions">
								<a href="/permissoes/editarPermissao/{{id_permissao}}" class="btn-action btn-edit">
									<i class="bi bi-pencil"></i>
									<span>Editar</span>
								</a>
								<a href="/permissoes/excluirPermissao/{{id_permissao}}" class="btn-action btn-delete">
									<i class="bi bi-trash"></i>
									<span>Excluir</span>
								</a>
							</td>
						</tr>
					{{/each}}
				{{else}}
					<tr class="empty-message-row">
						<td colspan="9" class="empty-message">
							Nenhuma permissão cadastrada. Clique no botão <i class="bi bi-plus" style="font-size: 1.2rem;"></i> para adicionar.
						</td>
					</tr>
				{{/if}}
			</tbody>
		</table>
	</div>
</div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<link rel="stylesheet" href="/stylesheets/usuariosAdm.css">
<!-- Modal for permissions info -->
<div class="modal" id="permInfoModal" style="display:none;">
	<div class="modal-content" style="max-width:640px;">
		<div class="modal-header">
			<h2>Como funcionam as permissões</h2>
			<span class="close" id="permInfoClose">&times;</span>
		</div>
		<div class="modal-body" style="padding:18px 10px 24px;">
			<p style="margin-top:0;">Administrador = Sim: acesso total a Blocos, Andares, Tipos de Mesa/Sala, Permissões, Usuários e Salas (ignora as outras colunas)</p>
			<p>Administrador = Não: acesso apenas aos módulos com permissões específicas marcadas:</p>
			<ul>
				<li><strong>Usuários:</strong> precisa de 'Cadastrar/Editar/Arquivar Usuário'</li>
				<li><strong>Salas:</strong> precisa de 'Cadastrar/Editar/Arquivar Sala'</li>
				<li><strong>Reservas:</strong> visível para todos com acesso ao Gerenciador ADM</li>
			</ul>
		</div>
	</div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.btn-delete').forEach(function(btn) {
    btn.addEventListener('click', function(e) {
      if (!window.confirm('Tem certeza que deseja excluir esta permissão?')) {
        e.preventDefault();
      }
    });
  });
	// Modal open/close logic for permissions info
	const infoBtn = document.getElementById('btnPermInfo');
	const modal = document.getElementById('permInfoModal');
	const modalClose = document.getElementById('permInfoClose');
	if (infoBtn && modal) {
		infoBtn.addEventListener('click', function() {
			modal.style.display = 'flex';
			modal.style.alignItems = 'center';
			modal.style.justifyContent = 'center';
		});
	}
	if (modalClose) modalClose.addEventListener('click', function() { modal.style.display = 'none'; });
	// close when clicking outside modal-content
	if (modal) {
		modal.addEventListener('click', function(e) {
			if (e.target === modal) modal.style.display = 'none';
		});
	}
});
</script>
